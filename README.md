# 电影预订系统 (Movie Reservation System - MRS)

## 目录

1.  [项目概述](#1-项目概述)
2.  [核心功能](#2-核心功能)
3.  [技术选型](#3-技术选型)
4.  [架构设计](#4-架构设计)
    *   [分层架构](#41-分层架构)
    *   [模块化](#42-模块化)
5.  [数据模型概览](#5-数据模型概览)
6.  [API 端点概览](#6-api-端点概览)
7.  [关键设计考量](#7-关键设计考量)
    *   [高并发应对](#71-高并发应对)
    *   [缓存策略](#72-缓存策略)
    *   [数据一致性](#73-数据一致性)
    *   [可扩展性与未来演进](#74-可扩展性与未来演进)
8.  [环境要求与运行](#8-环境要求与运行)
9.  [项目文档](#9-项目文档)
10. [开发路线图](#10-开发路线图)

## 1. 项目概述

电影预订系统 (MRS) 是一个后端服务，旨在为用户提供一个完整、高效、可靠的电影票在线预订解决方案。系统支持用户注册登录、浏览电影、查询场次、选择座位、完成预订等操作。同时，它也为管理员提供了管理电影、排片、查看运营数据等后台功能。

本项目致力于构建一个具备工业级强度的应用，特别关注在高并发场景下的系统性能、数据一致性和可扩展性。我们采用了领域驱动设计(DDD)的思想，使用Go语言及其生态系统构建了一个清晰、模块化的系统架构，并为未来的功能迭代和系统演进奠定坚实的基础。

**核心目标：**

*   实现健壮的业务逻辑，尤其是高并发下的座位预订与库存管理。
*   构建清晰、分层、模块化的应用架构，易于理解、维护和扩展。
*   设计和实现高效的缓存策略，提升系统响应速度，降低数据库负载。
*   确保用户数据和交易的安全性与一致性。
*   为未来可能的微服务化、数据分片等演进做好架构准备。

## 2. 核心功能

### 2.1 用户认证与授权

*   **用户注册与登录**：提供安全的账户创建和登录机制，支持JWT认证。
*   **角色管理**：
    *   **普通用户 (USER)**：浏览电影、查询场次、预订座位、查看和取消个人订单。
    *   **管理员 (ADMIN)**：拥有用户权限，并能管理电影信息、影厅座位、放映计划、查看所有订单及系统报告。
*   **权限控制**：基于JWT的认证和基于角色的访问控制 (RBAC)。

### 2.2 电影与放映管理 (管理员)

*   **电影信息管理**：
    * 增删改查电影详情（标题、描述、海报、时长、类型等）
    * 电影类型(Genre)管理
    * 支持按类型、上映年份等条件筛选电影
*   **影厅与座位管理**：
    * 配置影厅信息（名称、屏幕类型、音响系统等）
    * 管理座位布局（行列、座位类型）
*   **放映计划管理**：
    * 为电影安排放映场次，设置时间和票价
    * 自动检查场次时间冲突
    * 支持查看特定日期的排期

### 2.3 预订管理 (用户)

*   **电影与场次浏览**：
    * 浏览电影列表，支持分页和条件筛选
    * 查看场次详情和座位状态
*   **座位预订**：
    * 实时查看和选择座位
    * 使用分布式锁确保座位预订的并发安全
*   **订单管理**：
    * 创建、确认和取消订单
    * 查看订单历史和状态

### 2.4 报告与分析 (管理员)

*   **销售报告**：查看预订统计、收入分析等运营数据。

## 3. 技术选型

*   **编程语言**: Go 1.22+
*   **Web 框架**: Gin (高性能HTTP路由和中间件)
*   **数据库**: MySQL 8.0+ (关系型数据库)
*   **ORM**: GORM (功能丰富的ORM库)
*   **缓存**: Redis (用于数据缓存、分布式锁)
*   **日志库**: Zap (高性能结构化日志)
*   **认证机制**: JWT (JSON Web Tokens)
*   **API 类型**: RESTful API
*   **容器化**: Docker, Docker Compose
*   **未来演进技术储备**:
    *   **服务间通信**: gRPC
    *   **消息队列**: Apache Kafka / NATS (用于异步任务、削峰填谷)
    *   **服务发现/注册**: Consul / etcd
    *   **配置中心**: Consul / etcd / Apollo
    *   **分布式追踪**: Jaeger / Zipkin (基于 OpenTelemetry)
    *   **数据库分片方案**: Vitess / Apache ShardingSphere / 自定义路由
    *   **全局 ID 生成**: Snowflake / UUID v7

## 4. 架构设计

本项目采用清晰的分层架构和模块化设计，以实现高内聚、低耦合，并为未来的扩展和维护提供便利。

### 4.1 分层架构

项目采用领域驱动设计(DDD)的分层架构，主要包括接口层、应用层、领域层和基础设施层。每层的具体职责和实现细节请参见：

👉 [项目结构说明](./docs/PROJECT_STRUCTURE.md)

### 4.2 模块化

系统按业务领域划分为用户、电影、影厅、场次、预订和报告等核心模块。每个模块的详细分类和职责请参见：

👉 [服务分类说明](./docs/SERVICE_CLASSIFICATION.md)

## 5. 数据模型概览

系统的核心数据实体包括用户(User)、角色(Role)、电影(Movie)、类型(Genre)、影厅(CinemaHall)、座位(Seat)、场次(Showtime)、订单(Booking)等。完整的数据模型设计请参见：

👉 [数据模型设计](./docs/DATA_MODEL.md)

## 6. API 端点概览

系统提供RESTful API，主要包括用户认证、电影管理、影厅管理、场次管理、订单管理等功能模块。详细的API规范请参见：

👉 [API接口规范](./docs/API_SPECIFICATION.md)

## 7. 关键设计考量

### 7.1 高并发应对

*   **缓存优化**:
    * 电影信息和场次信息的详情缓存与列表缓存
    * 座位状态的位图缓存

*   **并发控制**:
    * 基于Redis的分布式锁
    * 座位预订的原子性保证
    * 数据库事务隔离

*   **性能优化**:
    * 批量操作优化
    * 索引优化

### 7.2 缓存策略

*   **Redis缓存**:
    * 电影信息缓存
    * 场次信息缓存
    * 座位状态位图缓存

*   **缓存模式**:
    * Cache-Aside模式
    * 写时失效策略
    * 合理的过期时间设置

*   **缓存优化**:
    * 批量获取和更新
    * 防止缓存穿透
    * 支持列表缓存

### 7.3 数据一致性

*   **事务管理**:
    * 基于GORM的事务支持
    * Unit of Work模式

*   **并发控制**:
    * 分布式锁

### 7.4 可扩展性与未来演进

*   **微服务化准备**:
    * 清晰的领域边界
    * 接口驱动设计
    * 事件驱动架构准备

*   **数据扩展**:
    * 分库分表方案
    * 读写分离准备
    * 缓存扩展机制

*   **监控与可观测性**:
    * 分布式追踪
    * 性能指标收集
    * 日志聚合方案

## 8. 环境要求与运行

### 系统要求
* Go 1.22+
* MySQL 8.0+
* Redis 6.x+
* Docker & Docker Compose

具体的安装、配置和运行步骤将在项目初始化后补充。

```bash
# 示例 (占位)
git clone <repository-url>
cd mrs
cp configs/app.example.yaml configs/app.yaml # 编辑配置
docker-compose up --build -d
# ./scripts/run_migrations.sh # (假设有迁移脚本)
# ./mrs-server # (如果手动运行二进制文件)

```

## 9. 项目文档

- [API_SPECIFICATION.md](./docs/API_SPECIFICATION.md): API接口规范
- [DATA_MODEL.md](./docs/DATA_MODEL.md): 数据模型设计
- [DEVELOPMENT_ROADMAP.md](./docs/DEVELOPMENT_ROADMAP.md): 开发路线图
- [PROJECT_STRUCTURE.md](./docs/PROJECT_STRUCTURE.md): 项目结构说明
- [SERVICE_CLASSIFICATION.md](./docs/SERVICE_CLASSIFICATION.md): 服务分类说明

## 10. 开发路线图

请参见 [DEVELOPMENT_ROADMAP.md](./docs/DEVELOPMENT_ROADMAP.md) 了解详细的开发计划和里程碑。
