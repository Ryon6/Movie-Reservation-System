### 数据模型详解

1.  **`User` 表 (用户表)**
    *   **含义**: 存储系统所有注册用户的信息。
    *   **字段**:
        *   `id`: 用户唯一标识符 (主键)。通常是一个自增整数或 UUID。
        *   `username`: 用户名，用于登录，通常要求唯一。
        *   `password_hash`: 存储用户密码的哈希值，**绝不能存储明文密码**。出于安全考虑，我们会存储密码经过哈希算法（如 bcrypt, scrypt）处理后的结果。
        *   `email`: 用户的电子邮箱，可用于登录、接收通知或密码找回，通常要求唯一。
        *   `role_id`: 外键，关联到 `Role` 表的 `id`，表示该用户的角色。

2.  **`Role` 表 (角色表)**
    *   **含义**: 定义系统中的用户角色。这样做的好处是将角色与权限分离开，方便管理。
    *   **字段**:
        *   `id`: 角色唯一标识符 (主键)。
        *   `name`: 角色名称 (例如：'ADMIN', 'USER')。这个字段通常会设置唯一约束。

3.  **`Movie` 表 (电影表)**
    *   **含义**: 存储电影的基本信息。
    *   **字段**:
        *   `id`: 电影唯一标识符 (主键)。
        *   `title`: 电影标题。
        *   `description`: 电影的剧情简介或描述。
        *   `poster_image_url`: 电影海报图片的URL地址。
        *   `duration_minutes`: 电影时长，单位为分钟。

4.  **`Genre` 表 (类型表)**
    *   **含义**: 存储电影的类型，如动作、喜剧、科幻等。
    *   **字段**:
        *   `id`: 类型唯一标识符 (主键)。
        *   `name`: 类型名称 (例如：'Action', 'Comedy', 'Sci-Fi')。这个字段通常会设置唯一约束。

5.  **`MovieGenre` 表 (电影类型关联表)**
    *   **含义**: 这是一个**中间表 (Junction Table / Pivot Table)**，用于表示电影 (Movie) 和类型 (Genre) 之间的**多对多关系**。一部电影可以有多个类型（如 "动作/科幻"），一个类型也可以包含多部电影。
    *   **字段**:
        *   `movie_id`: 外键，关联到 `Movie` 表的 `id`。
        *   `genre_id`: 外键，关联到 `Genre` 表的 `id`。
        *   通常 `(movie_id, genre_id)` 组合起来作为联合主键，确保同一部电影不会重复关联同一个类型。

6.  **`CinemaHall` 表 (影厅表)**
    *   **含义**: 存储电影院中各个影厅的信息。
    *   **字段**:
        *   `id`: 影厅唯一标识符 (主键)。
        *   `name`: 影厅名称 (例如："1号厅", "IMAX厅")。
        *   `total_seats`: 该影厅的总座位数。这个字段可以用于快速计算上座率等，但具体的座位布局可能更复杂，由 `Seat` 表定义。

7.  **`Showtime` 表 (放映时间表)**
    *   **含义**: 核心表之一，存储电影的具体放映安排。它将电影、影厅和时间关联起来。
    *   **字段**:
        *   `id`: 放映场次唯一标识符 (主键)。
        *   `movie_id`: 外键，关联到 `Movie` 表的 `id`，表示这场放映的是哪部电影。
        *   `hall_id`: 外键，关联到 `CinemaHall` 表的 `id`，表示这场电影在哪个影厅放映。
        *   `start_time`: 放映开始时间 (日期和时间)。
        *   `end_time`: 放映结束时间 (日期和时间)。这个可以通过 `start_time` 和 `Movie.duration_minutes` 计算得出，也可以显式存储，方便查询。
        *   `price_per_seat`: 该场次的每个座位的票价。可以根据不同场次、不同时间（如工作日、周末）设置不同价格。

8.  **`Seat` 表 (座位表)**
    *   **含义**: 定义影厅内每个物理座位的具体信息。这个表的设计可以有多种方式，取决于你希望座位管理的精细程度。
        *   **方案一 (简单方案)**: 如果所有影厅的座位布局简单且统一，或者你不想管理座位类型（如普通座、VIP座），此表可以简化，甚至座位信息可以隐含在 `BookedSeat` 中（只记录行号列号）。
        *   **方案二 (当前模型倾向的精细方案)**:
            *   `id`: 座位唯一标识符 (主键)。
            *   `hall_id`: 外键，关联到 `CinemaHall` 表的 `id`，表示这个座位属于哪个影厅。
            *   `row_identifier`: 座位行标识 (例如："A", "B", 或数字 1, 2)。
            *   `seat_number`: 座位列号 (例如：1, 2, 3)。
            *   `type`: 座位类型 (例如：'REGULAR', 'VIP', 'ACCESSIBLE')。可以是一个枚举或关联到另一个 `SeatType` 表。
        *   这个表描述的是物理座位本身。某一个 `Showtime` 的可用座位状态，会通过 `BookedSeat` 表来反映。

9.  **`Booking` 表 (预订订单表)**
    *   **含义**: 存储用户的预订订单信息。每一条记录代表一次成功的预订（可能包含一个或多个座位）。
    *   **字段**:
        *   `id`: 预订订单唯一标识符 (主键)。
        *   `user_id`: 外键，关联到 `User` 表的 `id`，表示这个订单是哪个用户下的。
        *   `showtime_id`: 外键，关联到 `Showtime` 表的 `id`，表示这个订单预订的是哪个场次。
        *   `booking_time`: 订单创建的时间戳。
        *   `total_amount`: 这个订单的总金额。
        *   `status`: 订单状态 (例如：'CONFIRMED' - 已确认, 'CANCELLED' - 已取消, 'PENDING_PAYMENT' - 待支付)。

10. **`BookedSeat` 表 (已预订座位表)**
    *   **含义**: 这是连接 `Booking` (订单) 和 `Showtime` (具体场次) 与 `Seat` (物理座位) 的关键表，用于记录一个订单具体预订了某个场次的哪些座位。它是实现座位锁定和防止超额预订的核心。
    *   **字段**:
        *   `id`: 已预订座位记录的唯一标识符 (主键)。
        *   `booking_id`: 外键，关联到 `Booking` 表的 `id`，表示这条座位预订记录属于哪个订单。
        *   `showtime_id`: 外键，关联到 `Showtime` 表的 `id`。虽然 `Booking` 表中已有 `showtime_id`，但在这里冗余有时能方便查询特定场次已预订的座位，而无需先JOIN `Booking`。这是一个可以根据查询需求优化的点。
        *   `seat_id`: 外键，关联到 `Seat` 表的 `id`，表示具体预订的是哪个物理座位。
        *   **替代方案**: 如果不使用全局唯一的 `seat_id`，这里也可以存储 `row_identifier` 和 `seat_number`，并结合 `showtime_id` (间接关联到 `hall_id`) 来唯一确定一个座位。
    *   **约束**: 对于同一个 `showtime_id` 和 `seat_id` 的组合，应该有唯一约束，确保一个座位在一个场次中只被预订一次。

### 关系总结：

*   一个 `User` 可以有多个 `Booking`。
*   一个 `Role` 可以被多个 `User` 拥有。
*   一个 `Movie` 可以有多个 `Genre` (通过 `MovieGenre` 表)。
*   一个 `Genre` 可以包含多个 `Movie` (通过 `MovieGenre` 表)。
*   一个 `Movie` 可以有多个 `Showtime`。
*   一个 `CinemaHall` 可以有多个 `Showtime`。
*   一个 `CinemaHall` 包含多个 `Seat`。
*   一个 `Showtime` 对应一个 `Movie` 和一个 `CinemaHall`。
*   一个 `Booking` 对应一个 `User` 和一个 `Showtime`。
*   一个 `Booking` 可以包含多个 `BookedSeat` (即一次预订多个座位)。
*   一个 `BookedSeat` 记录了某 `Booking` 在某 `Showtime` 预订的某个具体 `Seat`。

理解这些表和它们之间的关系是设计后端逻辑的基础。例如，当用户要预订座位时：
1.  你需要知道是哪个 `User` (`user_id`)。
2.  用户会选择一个 `Showtime` (`showtime_id`)。
3.  然后用户会选择一个或多个 `Seat` (`seat_id` 或 行/列号)。
4.  系统需要检查这些 `Seat` 在该 `Showtime` 下是否还可用（即在 `BookedSeat` 表中没有对应 `showtime_id` 和 `seat_id` 的记录）。
5.  如果可用，则创建一条 `Booking` 记录，并为每个选择的座位在 `BookedSeat` 表中插入一条记录。
